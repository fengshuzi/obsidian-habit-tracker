# 掌控习惯 - 功能说明

## 核心功能

### 1. 习惯打卡识别
- 使用标签形式：`#关键词`（如 `#reading`、`#exercise`）
- 自动扫描 `journals` 文件夹中的 `yyyy-mm-dd.md` 格式文件
- 支持在日记的任何位置使用标签

### 2. 习惯列表视图
每个习惯显示：
- 习惯名称（中文）
- 打卡次数（在选定时间范围内）
- 连续打卡天数（带火焰图标 🔥）
- 最近7天打卡圆点
  - 绿色圆点 = 已打卡
  - 灰色圆点 = 未打卡

### 3. 时间筛选
- 本周：显示本周一到周日的数据
- 上周：显示上周一到周日的数据
- 本月：显示本月1号到月底的数据（默认）
- 上月：显示上月1号到月底的数据

### 4. 统计分析
- 总打卡次数：在选定时间范围内的总打卡次数
- 追踪习惯数：配置的习惯总数
- 各习惯统计：每个习惯的打卡次数和连续天数

### 5. 配置管理
**基础设置**
- 自定义应用名称（默认"掌控习惯"）
- 实时预览效果
- 保存后自动刷新视图

**习惯管理**
- 添加新习惯（关键词 + 中文名称）
- 删除习惯
- 修改习惯关键词和名称

## 性能优化

### 1. 文件扫描优化
- 只扫描 `yyyy-mm-dd.md` 格式的文件
- 跳过非日期格式文件（README.md、模板等）
- 批量并行处理，提升加载速度

### 2. 智能缓存机制
- 30秒缓存时间
- 文件修改自动清除缓存
- 文件创建自动清除缓存
- 文件删除自动清除缓存

### 3. 文件监听
- 监听 `journals` 文件夹的文件变化
- 自动更新缓存，无需手动刷新

## UI 设计

### Notion 风格
- 现代化的卡片设计
- 渐变色背景
- 圆角边框
- 阴影效果
- 悬停动画

### 响应式设计
- 支持桌面端和移动端
- 自适应布局
- 触摸友好

## 使用场景

### 场景1：每日打卡
```markdown
# 2024-01-10

今天完成了阅读和运动 #reading #exercise

早上冥想了10分钟 #meditation
```

### 场景2：回顾本周
1. 打开掌控习惯视图
2. 点击"本周"按钮
3. 查看本周的打卡情况
4. 查看7天圆点，了解每天的打卡状态

### 场景3：追踪连续天数
1. 查看习惯列表
2. 找到带火焰图标 🔥 的习惯
3. 查看连续打卡天数
4. 保持连续打卡，挑战更高天数

### 场景4：自定义习惯
1. 点击"配置习惯"按钮
2. 切换到"习惯管理"标签页
3. 点击"+ 添加新习惯"
4. 输入关键词（如 `coding`）和名称（如 `编程`）
5. 保存配置

## 技术实现

### 核心类
- `HabitParser`：习惯记录解析器
- `HabitStorage`：习惯数据管理器（含缓存和文件监听）
- `HabitTrackerView`：习惯追踪视图
- `HabitConfigModal`：配置模态框
- `HabitTrackerPlugin`：主插件类

### 关键方法
- `parseRecord()`：解析单行习惯打卡记录
- `getAllRecords()`：获取所有打卡记录（含缓存）
- `filterRecordsByDateRange()`：按日期范围筛选记录
- `calculateStatistics()`：计算统计数据
- `calculateStreak()`：计算连续打卡天数
- `getLast7Days()`：获取最近7天的日期

### 数据结构
```javascript
// 打卡记录
{
    date: "2024-01-10",
    habitKey: "reading",
    habitName: "阅读",
    rawLine: "今天完成了 #reading"
}

// 统计数据
{
    totalCheckins: 100,
    habitStats: {
        "reading": {
            name: "阅读",
            count: 30,
            dates: ["2024-01-10", "2024-01-09", ...]
        }
    },
    dailyStats: {
        "2024-01-10": {
            habits: ["reading", "exercise"],
            count: 2
        }
    },
    streaks: {
        "reading": 7
    }
}
```

## 部署说明

### 构建
```bash
npm run build
```

### 部署
```bash
npm run deploy
```

部署脚本会自动将插件复制到所有配置的 vault 中：
- 漂泊者及其影子（多个配置）
- note-demo

### 文件列表
- `dist/main.js`：编译后的主文件
- `manifest.json`：插件清单
- `styles.css`：样式文件
- `config.json`：配置文件（会被强制覆盖）

## 注意事项

1. 日记文件必须放在 `journals` 文件夹中
2. 日记文件名必须是 `yyyy-mm-dd.md` 格式
3. 使用标签形式打卡：`#关键词`
4. 配置修改后会自动刷新视图
5. 首次加载可能需要几秒钟扫描所有日记文件
6. 部署时配置文件会被强制覆盖（用户要求）

## 未来优化方向

1. 支持自定义日记文件夹路径
2. 支持自定义日期格式
3. 支持导出统计数据
4. 支持习惯目标设置
5. 支持习惯提醒功能
6. 支持更多时间筛选选项（自定义日期范围）
7. 支持习惯分类管理
8. 支持习惯完成度百分比显示
